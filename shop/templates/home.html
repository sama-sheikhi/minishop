{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link rel="stylesheet" href="{% static 'home.css' %}">
</head>
<body>

    <!-- Header / Nav -->
    <header class="site-header">
        <h2 class="title">All Products</h2>

        <div class="nav-actions">
            <a href="{% url 'search' %}" class="search-btn">üîç Search</a>
            {% if request.user.is_authenticated %}
                <a href="{% url 'orders_list' %}" class="orders-btn">üì¶ My Orders</a>
                <a href="{% url 'profile' %}" class="profile-btn">Profile</a>
                <a href="{% url 'logout' %}" class="logout-btn">Logout</a>
                <a href="{% url 'cart' %}" class="cart-btn">üõí Cart</a>
            {% else %}
                <a href="{% url 'login' %}" class="login-btn">Login</a>
                <a href="{% url 'register' %}" class="register-btn">Register</a>
            {% endif %}
        </div>
    </header> 

    <!-- Products List -->
    {% if products %}
        {% for product in products %}
            <div class="product">
                <div class="top">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" width="250">
                </div>
                <div class="bottom">
                    <h3>{{ product.name }}</h3>
                    <p><small>By: {{ product.owner.username }}</small></p>
                    <p><strong>Price:</strong> {{ product.price }} $</p>

                    <!-- Stock / Status -->
                    <p><strong>Status:</strong>
                        {% if not product.is_active %}
                            Not Available for Sale
                        {% elif product.stock == 0 %}
                            Out of Stock
                        {% else %}
                            {{ product.stock }} available
                        {% endif %}
                    </p>

                    {% if request.user == product.owner or request.user.is_superuser %}
                        <a href="{% url 'edit_product' product_id=product.id %}">Edit</a> |
                        <a href="{% url 'delete_product' product_id=product.id %}">Delete</a> |
                    {% endif %}

                    <a href="{% url 'product_detail' product_id=product.id %}">Details</a>

                    <!-- Add to Cart / Login Button -->
                    {% if request.user.is_authenticated %}
                        {% if product.is_active and product.stock > 0 %}
                            <a href="{% url 'add_to_cart' product.id %}" class="buy-btn">üõí Add to Cart</a>
                        {% else %}
                            <span class="disabled-btn">Cannot Buy</span>
                        {% endif %}
                    {% else %}
                        <a href="{% url 'login' %}" class="buy-btn">Login to Buy</a>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <h3 style="color:red;">No products available.</h3>
    {% endif %}

    <!-- Add Product / Login Prompt -->
    <hr>
    {% if request.user.is_authenticated %}
        <a href="{% url 'add_product' %}" class="add-btn">‚ûï Add New Product</a>
    {% else %}
        <a href="{% url 'login' %}" class="add-btn">Login to add products</a>
    {% endif %}

</body>
</html>
